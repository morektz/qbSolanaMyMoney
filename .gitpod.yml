# List the start up tasks. Learn more https://www.gitpod.io/docs/config-start-tasks/
# Installation packages for the work in this repo 

# Setting up a task template 

# - name: Rust Install
#   init: >
#     curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
#   command: |
#     source $HOME/.cargo/env
#     rustup component add rustfmt

tasks:

# Rust install 
- name: Rust Install
  init: |
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
    gp sync-done rustinstall
  command: |
    source $HOME/.cargo/env 
    rustup component add rustfmt
  openMode: tab-after

# Install Solana 
- name: Solana Install
  init: |
   gp sync-await rustinstall
   sh -c "$(curl -sSfL https://release.solana.com/v1.8.0/install)" 
   export PATH="/home/gitpod/.local/share/solana/install/active_release/bin:$PATH" 
   source ~/.bashrc 
   echo $PATH | grep solana 
  command:  solana
  openMode: tab-after

# Install Solana 
- name: NPM Update
  init: |
    npm update -g 
    gp sync-done npmy
  command: npm --version
  openMode: tab-after

# Install Solana 
- name: Mocha Global install 
  init: |
    gp sync-await npmy
    npm install -g mocha
  openMode: tab-after

# Install Anchor
- name: Anchor Install 
  init: |
    gp sync-await npmy
    npm i -g @project-serum/anchor-cli
  command: anchor 
  openMode: tab-after

# Add path when opening a new terminal
# You need to add these to bashrc everytime you open a terminal, since gitpod doesnt give permissions to edit 
# /etc/environment & /etc/profile
- name: Add Solana Path 
  init: |
    gp sync-await rustinstall
  command: . ./SetSolanaPath
  openMode: tab-after

#Install npm server - required to server port 8080 or whichever port solana wants opened 
- name: Install NPM Server
  init: |
    gp sync-done httpy
    gp sync-await npmy
    npm install --global http-server

# For solana to work properly you will need to open up multiple ports for testing following section will have '
# commands to do that '

- name: Open port 8080
  init: gp sync-await httpy
  command: http-server -p 8080
  openMode:  tab-after

- name: Open port 8900
  init: gp sync-await httpy
  command: http-server -p 8900 
  openMode: split-right

- name: Open port 8899
  init: gp sync-await httpy
  command: http-server -p 8899 
  openMode: split-right

#<--- Ports Section--->

# List the ports to expose. Learn more https://www.gitpod.io/docs/config-ports/
ports:
  - port: 8000-9000
    onOpen: open-preview
    visibility: public